# Fastfile
# Documentation: https://docs.fastlane.tools

default_platform(:ios)

platform :ios do

  ########################################################
  # Custom Lane (for any custom tasks)
  ########################################################
  desc "Run custom tasks"
  lane :custom_lane do
    # Add custom actions here
    # Example: run tests, clean, etc.
    gym(scheme: "TestCI_CD")  # build your app using gym
  end

  ########################################################
  # Beta Lane (Upload to TestFlight)
  ########################################################
  desc "Beta iOS app - Upload to TestFlight"
  lane :beta do
    # Fetch certificates & provisioning profiles via Match
    match(type: "appstore")  # Use "development" or "adhoc" if needed

    # Build the app
    build_app(
      scheme: "TestCI_CD",
      export_method: "app-store"  # Can be: development, ad-hoc, enterprise
    )

    # Upload to TestFlight
    upload_to_testflight
  end

  ########################################################
  # Build Lane (Build iOS App)
  ########################################################
  desc "Build iOS app for release or CI/CD"
  lane :build do
    # Fetch certificates & provisioning profiles
    match(type: "appstore")  # or "development" for dev builds

    # Build the app
    build_app(
      scheme: "TestCI_CD",
      clean: true,
      export_method: "app-store", # Change to "development" if needed
      export_options: {
        provisioningProfiles: {
          "com.clover.testci-cd" => "Vishal Mestri"
        }
      }
    )
  end

  ########################################################
  # Optional: Lane for running tests
  ########################################################
  desc "Run unit tests"
  lane :tests do
    scan(scheme: "TestCI_CD")  # runs your tests
  end
end
